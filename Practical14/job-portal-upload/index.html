<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Resume Upload</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="upload-card" role="main">
      <h1>Upload your PDF resume</h1>
      <p class="lead">Only PDF files allowed. Max size: 2 MB.</p>

      <form
        id="uploadForm"
        action="http://localhost:3000/upload"
        method="post"
        enctype="multipart/form-data"
        novalidate
      >
        <div class="form-row">
          <div class="file-input-wrapper" aria-hidden="false">
            <label class="file-drop" for="resumeInput">
              <svg
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                aria-hidden="true"
              >
                <path
                  d="M12 3v12"
                  stroke="#4F46E5"
                  stroke-width="1.6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M8 7l4-4 4 4"
                  stroke="#4F46E5"
                  stroke-width="1.6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <rect
                  x="3"
                  y="13"
                  width="18"
                  height="8"
                  rx="2"
                  stroke="#E6E9F2"
                  stroke-width="1.2"
                  fill="#F8FAFF"
                ></rect>
              </svg>

              <div class="meta">
                <span class="name" id="fileName">Choose a PDF file</span>
                <span class="hint">Accepted: .pdf — Max 2 MB</span>
              </div>

              <input
                id="resumeInput"
                name="resume"
                type="file"
                accept="application/pdf"
                required
              />
            </label>
          </div>

          <button class="btn" type="submit">Upload</button>
        </div>

        <div id="msg" class="message" aria-live="polite"></div>
        <span class="small"
          >Tip: Server-side checks enforce file type and size. Client checks are
          only for convenience.</span
        >
      </form>
    </div>

    <script>
      // small client-side UX: show filename and size; prevent overly large files early
      const input = document.getElementById("resumeInput");
      const fileNameSpan = document.getElementById("fileName");
      const msg = document.getElementById("msg");
      const form = document.getElementById("uploadForm");

      input.addEventListener("change", () => {
        msg.textContent = "";
        const f = input.files[0];
        if (!f) {
          fileNameSpan.textContent = "Choose a PDF file";
          return;
        }
        fileNameSpan.textContent =
          f.name + " (" + Math.round(f.size / 1024) + " KB)";
        if (f.type !== "application/pdf") {
          msg.textContent = "Only PDF files are allowed.";
          msg.className = "message error";
          input.value = "";
        } else if (f.size > 2 * 1024 * 1024) {
          msg.textContent = "File too large. Max allowed size is 2 MB.";
          msg.className = "message error";
          input.value = "";
          fileNameSpan.textContent = "Choose a PDF file";
        } else {
          msg.textContent = "";
          msg.className = "message";
        }
      });

      // optional: show server response in the UI after submit
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        msg.textContent = "Uploading...";
        msg.className = "message";

        const file = input.files[0];
        if (!file) {
          msg.textContent = "Please choose a file first.";
          msg.className = "message error";
          return;
        }

        const formData = new FormData();
        formData.append("resume", file);

        try {
          const res = await fetch(form.action, {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          if (!res.ok) {
            msg.textContent = data.error || "Upload failed";
            msg.className = "message error";
          } else {
            msg.textContent = data.message || "Upload successful";
            msg.className = "message success";
            // show saved filename from server if provided
            if (data.filename)
              fileNameSpan.textContent = "Saved as: " + data.filename;
            input.value = "";
          }
        } catch (err) {
          msg.textContent = "Network error — could not upload.";
          msg.className = "message error";
        }
      });
    </script>
  </body>
</html>
